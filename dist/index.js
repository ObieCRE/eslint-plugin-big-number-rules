/*
 * eslint-plugin-big-number-rules
 * v1.3.0
 * https://github.com/shuckster/eslint-plugin-big-number-rules
 * License: MIT
 */
"use strict";var e={isPojo:function(e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype}};const{isPojo:t}=e;function r(e="construct",r="BigNumber"){return n=>{const{settings:i}=n,a=i["big-number-rules"]?.[e]??r;return t(r)&&t(a)&&r!==a?{...r,...a}:a}}const n=r("construct","BigNumber");var i={makeSettingGetter:r,isPojo:t,getConstruct:n};const{makeSettingGetter:a,getConstruct:o}=i,c=a("arithmetic",{"+":"plus","-":"minus","/":"dividedBy","*":"multipliedBy","**":"exponentiatedBy","%":"modulo","<":"isLessThan","<=":"isLessThanOrEqualTo","===":"isEqualTo","==":"isEqualTo",">=":"isGreaterThanOrEqualTo",">":"isGreaterThan"}),s=a("bitwise",{">>":"shiftedBy",">>>":"shiftedBy","<<":["${L}","shiftedBy","-${R}"]}),u=a("sum","sum"),l=a("supportsSum",!0),p=a("supportsBitwise",!0);function m(e){return"CallExpression"===e?.type&&"MemberExpression"===e?.callee?.type}function f(e,t){return function(e,t){return"CallExpression"===t?.type&&"Identifier"===t?.callee?.type&&t?.callee?.name===o(e)}(e,t)||function(e,t){return m(t)&&"Identifier"===t?.callee?.object?.type&&t?.callee?.object?.name===o(e)&&"Identifier"===t?.callee?.property?.type&&t?.callee?.property?.name===u(e)}(e,t)}const g=[];function b(e){try{if("BinaryExpression"!==e.type)return!0;if("+"!==e.operator)throw new Error("not a +");return b(e.left)&&b(e.right)}catch(e){return!1}}function d(e){const t=p(e),r=c(e),n=Object.keys(r),i=s(e),a=Object.keys(i),u={...r,...i};function d(t,r,n){const i=u[r];return(function(e){return Array.isArray(e)&&3===e.length&&e.every((e=>"string"==typeof e))}(i)?function(t){return(r,n)=>t.map((t=>t.replace("__CONSTRUCT__",o(e)).replace("${L}",r).replace("${R}",n)))}(i):(e,t)=>[e,i,t])(t,n)}return r=>{const i=n.includes(r.operator),c=a.includes(r.operator);if(!i&&!c)return;const s=e.getSource(r);if(c&&!t){const t=o(e);return void e.report({node:r,message:`is '${s}' a financial calculation? If so, bitwise methods are not supported by ${t}\n`})}const u=l(e)&&b(r),p=function(e,t){let r=t;for(;!f(e,r);){if(!m(r))return!1;r=r.callee.object}return!0}(e,r.left);g.push({node:r,original:s,summable:u&&!p,report:{node:r,message:`is '${s}' a financial calculation?`,fix:t=>{const{operator:n,left:i,right:a}=r,c=e.getSource(i),s=e.getSource(a);return p?t.replaceText(r,function(e,t,r){const[,n,i]=d(e,t,r);return`${e}.${n}(${i})`}(c,n,s)):t.replaceText(r,function(e,t,r,n){const i=o(e),[a,c,s]=d(t,r,n);return`${i}(${a}).${c}(${s})`}(e,c,n,s))}}})}}function y(e,t){return"BinaryExpression"!==t.type?[e.getSource(t)]:[...y(e,t.left),...y(e,t.right)].flat()}function $(e,t){const r=y(e,t).join(", ");return`${o(e)}.${u(e)}(${r})`}function h(e){return t=>{if(r=t,!g.find((({node:e})=>e===r)))return;var r;const{node:n,original:i,summable:a,report:o}=g.pop();a?g.length&&g[g.length-1]?.summable||e.report({node:n,message:`is '${i}' a financial calculation?`,fix:t=>t.replaceText(n,$(e,n))}):e.report(o)}}var x={create:e=>({BinaryExpression:d(e),"BinaryExpression:exit":h(e)}),meta:{category:"Financial, Currency",description:"Replace JavaScript arithmetic with BigNumber methods",fixable:"code"}};const{getConstruct:N}=i;function _(e){return(t,r)=>{const n=r.parent;if("MemberExpression"!==n.type)return!1;const i=e.replace("__CONSTRUCT__",N(t));return"CallExpression"===n?.object?.type&&"Identifier"===n?.object?.callee?.type&&n?.object?.callee?.name===i||"Identifier"===n?.object?.type&&n?.object?.name===i}}const C=_("__CONSTRUCT__");var S={IdentifierIsAlreadyBigNumberMethod:C,makeIdentifierMembershipDetector:_,makeGlobalIdentifierFixer:function(e){const t=Object.keys(e);return r=>n=>{if(!t.includes(n.name))return;if(C(r,n))return;const i=r.getSource(n);r.report({node:n,message:`is '${i}' a financial calculation?`,fix:t=>{const i=e[n.name];return t.replaceText(n,i(r))}})}}};const{getConstruct:T}=i,{makeGlobalIdentifierFixer:O}=S,j=O({isNaN:e=>`${T(e)}.isNaN`});var B={create:e=>({Identifier:j(e)}),meta:{category:"Financial, Currency",description:"Replace isNaN with BigNumber equivalent",fixable:"code"}};const{makeSettingGetter:E,getConstruct:R}=i,I=E("math",{min:"minimum",max:"maximum",random:"random",abs:"absoluteValue",sign:["__CONSTRUCT__(${A}).comparedTo(0)"],sqrt:"squareRoot"});function v(e){const t=I(e),r=Object.keys(t);return n=>{const{callee:i}=n;if("MemberExpression"!==i.type)return;if("Math"!==i?.object?.name)return;const a=i?.property?.name;if(!r.includes(a))return;const o=e.getSource(n);e.report({node:n,message:`is '${o}' a financial calculation?`,fix:r=>r.replaceText(n,function(e,r,n){const i=t[n],a=r.arguments.map((t=>e.getSource(t))).join(", "),o=R(e);if(Array.isArray(i)){if(1===i.length)return i[0].replace("__CONSTRUCT__",o).replace("${A}",a);if(2===i.length)return`${o}.${i[0]}(${i.slice(1).map((e=>e.replace("${A}",a)))})`}return`${o}.${i}(${a})`}(e,n,a))})}}var A={create:e=>({CallExpression:v(e)}),meta:{category:"Financial, Currency",description:"Replace JavaScript Math methods with BigNumber equivalents",fixable:"code"}};const{makeSettingGetter:F,getConstruct:w}=i,{IdentifierIsAlreadyBigNumberMethod:k}=S,M=F("number",{toFixed:"decimalPlaces",parseFloat:["__CONSTRUCT__(${A})"],toExponential:"toExponential",toPrecision:"toPrecision",toString:"toString"});function U(e){const t=M(e),r=Object.keys(t);return n=>{const{callee:i}=n;if("MemberExpression"!==i.type)return;if("Identifier"!==i?.property?.type)return;const a=i?.property?.name;if(!r.includes(a))return;if(k(e,i?.property))return;const o=e.getSource(n);e.report({node:n,message:`is '${o}' a financial calculation??`,fix:r=>r.replaceText(n,function(e,r,n){const i=t[n],a=r.arguments.map((t=>e.getSource(t))).join(", "),o=w(e),c=e.getSource(r?.callee?.object);return"Number"===r?.callee?.object?.name&&Array.isArray(i)&&1===i.length?i[0].replace("__CONSTRUCT__",o).replace("${O}",c).replace("${A}",a):`${o}(${c}).${i}(${a})`}(e,n,a))})}}var G={create:e=>({CallExpression:U(e)}),meta:{category:"Financial, Currency",description:"Replace JavaScript Number.prototype methods with BigNumber equivalents",fixable:"code"}};const{getConstruct:q}=i,{makeGlobalIdentifierFixer:D}=S,P=D({parseFloat:e=>q(e)});var L={create:e=>({Identifier:P(e)}),meta:{category:"Financial, Currency",description:"Replace parseFloat with BigNumber equivalent",fixable:"code"}};const{makeSettingGetter:J,getConstruct:H}=i,V={floor:"BigNumber.set({\n  ROUNDING_MODE: BigNumber.ROUND_FLOOR\n})}",ceil:"BigNumber.set({\n  ROUNDING_MODE: BigNumber.ROUND_CEIL\n})}",round:"BigNumber.set({\n  ROUNDING_MODE: BigNumber.ROUND_HALF_UP\n})}"},W=J("supportsRound",!1),z=J("rounding",V);function K(e){const t=Object.keys(V),r=z(e);return n=>{const{callee:i}=n;if("MemberExpression"!==i.type)return;if("Math"!==i?.object?.name)return;const a=i?.property?.name;if(!t.includes(a))return;const o=W(e),c=e.getSource(n);o?e.report({node:n,message:`is '${c}' a financial calculation?`,fix:t=>t.replaceText(n,function(e,t,n){const i=r[n],a=t.arguments.map((t=>e.getSource(t))).join(", "),o=H(e);if(Array.isArray(i)){if(1===i.length)return i[0].replace("__CONSTRUCT__",o).replace("${A}",a);if(2===i.length)return`${o}.${i[0]}(${i.slice(1).map((e=>e.replace("${A}",a)))})`}return`${o}.${i}(${a})`}(e,n,a))}):e.report({node:n,message:`is '${c}' a financial calculation? If so, use the global constructor setting:\n\n${r[a]}\n`})}}var Q={rules:{arithmetic:x,isNaN:B,math:A,number:G,parseFloat:L,rounding:{create:e=>({CallExpression:K(e)}),meta:{category:"Financial, Currency",description:"Warn against using JavaScript Math.round|ceil|floor methods, or offer replacements",fixable:"code"}}},configs:{recommended:{rules:{"big-number-rules/arithmetic":"warn","big-number-rules/isNaN":"warn","big-number-rules/math":"warn","big-number-rules/number":"warn","big-number-rules/parseFloat":"warn","big-number-rules/rounding":"warn"}}}};module.exports=Q;
